<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Pokemon Go Tool">
    <meta name="keywords" content="Pokemon Go">
    <meta name="author" content="Mark Onofrio">
    <title>Pokemon Go Search Tool</title>
    <meta>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="./data/data.js"></script>
    <script src="./data/Pokemon_Raid_Hundo_CP.js"></script>
<body>

<script>
    let superString = "!favorite & !shiny & !3* & !4* & !lucky & !ultra beasts & !12candy & !purify & !free-evol & !evol & !pvp & !xl & !xxl & &!legendary & !mythical";

    function copySearchString (id) {
        let output = data[id]['search']
        let pokemon = data[id]['pokemon']
        let tag = data[id]['tag']

        /** Safe Transfer */
        if(output === '' && tag === "" && pokemon === "" || data[id]['name'] === "Safe Transfer"){
            copyContent(superString);
        }
        /** Has Tag, Pokemon, & Search Value*/
        else if( tag.length > 0 && pokemon.length > 0 && output.length > 0){

            copyContent( output + " & " + pokemon + " & !" + tag );
        } else if ( tag.length > 0 && pokemon.length > 0){
            copyContent( pokemon + " & !" + tag )
        }

    }

    function findNew(id){
        let output = data[id]['value']  + " & !" + data[id]['tag'];
        copyContent(output);
    }

    function copyTag(id){
        let output = data[id]['tag'];
        copyContent(output);
    }

    async function copyContent(data) {
        let text = data;

        try {
            await navigator.clipboard.writeText(text);
            console.log('Content copied to clipboard');
            console.log('-- Value: ' + text)
            /* Resolved - text copied to clipboard successfully */
        } catch (err) {
            console.error('Failed to copy: ', err);
            /* Rejected - text failed to copy to the clipboard */
        }
    }
</script>
<div class="container">
    <div id="app"></div>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <!-- Babel Script -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/jsx">
        const app = document.getElementById('app');
        const title = "Pokemon Go Sidekick Tool"

// TODO: Add Star piece before the end of Go Battle League
// TODO: Ditto Change Up


        function Alerts(){
            return (
                <div className="alert alert-warning" role="alert">
                    <strong>This is still in Beta.</strong> <br/>
                </div>
            )
        }

        function Header(){
            return (
                <header>
                    <Alerts />
                    <h1>{title} </h1>
                </header>
            )
        }

        function Footer(){
            return (
                <small>Last Updated: {appInfo.updated} - Ver: {appInfo.version}</small>
            )
        }

        function SearchList(){
            return(
                    <ul className="list-group">
                        {data.map( (val) => (
                            <li className={'list-group-item'} key={val.name}>
                                <div className={"row"} >
                                    <div className={"col"}>
                                        <h4>{val.title} &nbsp;
                                            { (val.info === "")? "" :<><button type="button" className={"btn btn-outline-info btn-sm"} data-bs-toggle={"modal"} data-bs-target={"#" + "Modal" + val.id }>more info</button></>}
                                            {(val.tag === "")? "" : <><br/><button className={"btn btn-dark btn h6"} onClick={ () => copyTag(val.id) } >Tag: {val.tag}</button></> }
                                        </h4>
                                    </div>
                                    <div className="col">
                                        <div className={"d-flex p-2"}>
                                            <button className={"btn btn-success btn-lg"} onClick={() => copySearchString(val.id) }>Copy Search String</button>
                                        </div>
                                    </div>
                                </div>
                                { (val.info === "")? "" : <Modal val={val}/>}
                            </li>
                        ))}
                    </ul>
            )
        }

        function SearchOptions(){
            return (
                <div className="btn-group" role="group" aria-label="Basic checkbox toggle button group">
                    <input type="checkbox" className="btn-check" id="showFavorite" autoComplete="off" />
                    <label className="btn btn-outline-primary" htmlFor="showFavorite">Hide Favorite</label>
                </div>
            )
        }

        function Modal( {val} ){
            return(
                <div className="modal fade" id={"Modal" + val.id} tabIndex="-1" aria-labelledby={val.id + "ModalLabel"} aria-hidden="true">
                    <div className="modal-dialog">
                        <div className="modal-content">
                            <div className="modal-header">
                                <h1 className="modal-title fs-5" id="exampleModalLabel">{val.title}</h1>
                                <button type="button" className="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div className="modal-body">
                                { (val.info === "")? <p>No Information at this time</p> : <p>{val.info}</p> }
                            </div>
                            <div className="modal-footer">
                                <button type="button" className="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>

            )
        }


        function RaidCards ({currentDate, months}){
            return (
                eventData.map( ( value, index) => (
                    (value.eventType === "Raids" && currentDate >= new Date(value.startDate) && currentDate <= new Date(value.endDate) ) ?
                        <div className="event event--inline container card" key={"raid-" + index}>
                            <div className="event-layout row card-body">
                                {(!value.image) ? "" :
                                    <div className="event-image col">
                                        <img
                                            src={value.image.url}
                                            width="125" height="125" alt=""/>
                                    </div>
                                }
                                <div className="event-details col">
                                    <div className="raid-event-info">
                                        <div>
                                            <span className={"h3"}>{value.name}</span><br />
                                            <small className={"h6"}>{value.raidStarLevel} Raid</small>
                                            <p>
                                                { ( new Date( value.startDate ).getMonth()  !==  currentDate.getMonth() ) ? months[( currentDate.getMonth() )] : months[(new Date( value.startDate ).getMonth())] }&nbsp;
                                                { ( new Date(value.startDate + 'T00:00:00Z' ).getUTCDate() ) } -
                                                { ( new Date(value.endDate + 'T00:00:00Z' ).getUTCDate() ) }
                                            </p>
                                        </div>

                                        {
                                            Object.keys(raidCP).map( key => {
                                                let name = value.name;
                                                const raid = raidCP[key];
                                                const wordToRemove = "Mega";

                                                /** check if Mega is in the name and remove it to find the correct name look up*/
                                                const regex = new RegExp("\\b" + wordToRemove + "\\b", "gi");
                                                if( value.name.includes("Mega") ){
                                                    name = value.name.replace(regex, '').trim()
                                                }
                                                /** Show perfect IV for catching after a raid */
                                                return (raid.name === name) ? ( <div key={"mega"+index}>{raid.hundoCP} / {raid.hundoWeatherCP} <br/> <span style={ {fontSize: "0.7rem"} } >100% IV / Weather Boosted</span></div>) : ""
                                            })
                                        }
                                    </div>
                                </div>
                            </div>
                        </div> : ""
                ))
            )
        }

        function EventCards ({ currentDate, months}){
            return(
                eventData.map( ( value, index) => (

                    (
                        ( value.eventType === "Events" && value.bodyLines === undefined ) &&
                        (currentDate >= new Date(value.startDate) && currentDate <= new Date(value.endDate))
                        // && ( new Date().getDate() === ( new Date(value.startDate + 'T00:00:00Z' ).getUTCDate() ) )
                    ) ?
                        <div className="event event--inline container card" key={"event-" + index}>
                            <div className="event-layout row card-body">
                                {(!value.image) ? "" :
                                    <div className="event-image col">
                                        <img
                                            src={value.image.url}
                                            width="125" height="125" alt=""/>
                                    </div>
                                }
                                <div className="event-details col">
                                    <div className="raid-event-info">

                                        <span className={"h3"}>{value.name}</span>
                                        { value.bodyLines !== undefined? (<span> - {value.bodyLines[0]} </span>) : "" }
                                        <br />

                                        <p>
                                            { ( new Date( value.startDate ).getMonth()  !==  currentDate.getMonth() ) ? months[( currentDate.getMonth() )] : months[(new Date( value.startDate ).getMonth())] }&nbsp;
                                            { ( new Date(value.startDate + 'T00:00:00Z' ).getUTCDate() ) }
                                            { ( new Date(value.endDate + 'T00:00:00Z' ).getUTCDate() !==  new Date(value.startDate + 'T00:00:00Z' ).getUTCDate() )?
                                              " - " + ( new Date(value.endDate + 'T00:00:00Z' ).getUTCDate() )
                                                : ""
                                            }
                                            <br />
                                            {( value.bodyLines !== undefined ? (<span>{value.bodyLines[1]} </span>) : "")}
                                            {( value.body !== undefined) ? (<span>{value.body}</span>) : ""}
                                        </p>

                                    </div>
                                </div>
                            </div>
                        </div>
                        : ""
                ))
            )
        }


        function getDate(){
            let output,date, month, day;
            function isValidDateFormat(input) {
                // Regular expression for 'YYYY-MM-DD' pattern
                const datePattern = /^\d{4}-\d{2}-\d{2}$/;

                // Test the input against the pattern
                return datePattern.test(input);
            }

            if( arguments[0].toLowerCase() === "today"  && arguments.length === 1 ){
                output = new Date().getUTCDate()
            }
            if( arguments[0].toLowerCase() === "month" && arguments.length === 1 ){
                output = new Date().getUTCMonth()
            }
            if( isValidDateFormat(arguments[0]) ){
                output = new Date(arguments[0]).getUTCDate()
            }
            if( arguments.length > 1 ){

                Object.keys(arguments).map( index => {
                    if ( isValidDateFormat(arguments[index]) ) {
                         date = index
                    }
                    if ( arguments[index] === 'month'){
                        month = index
                    }
                    if ( arguments[index] === 'day'){
                        day = index
                    }
                })

                if( month !== undefined ){
                    output = new Date( arguments[date] ).getUTCMonth()
                }
                if( day !== undefined){
                    output = new Date( arguments[date] ).getUTCDate()
                }

            }
            console.log(output)
            return output
        }

        function SpotlightHourCard ({months, currentDate }){

            return(
                eventData.map( (value, index) => (
                         value.eventType === "Events" && value.bodyLines !== undefined &&
                             getDate("today") <= getDate(value.startDate, "day") &&
                             getDate("today") >= getDate(value.endDate, "day")
                     ?
                        <div className="event event--inline container card" key={"spotlight-" + index}>
                            <div className="event-layout row card-body">
                                {(!value.image) ? "" :
                                    <div className="event-image col">
                                        <img
                                            src={value.image.url}
                                            width="125" height="125" alt=""/>
                                    </div>
                                }
                                <div className="event-details col">
                                    <div className="raid-event-info">

                                        <span className={"h3"}>{value.name}</span>
                                        { value.bodyLines !== undefined? (<span> - {value.bodyLines[0]} </span>) : "" }
                                        <br />

                                        <p>
                                            { ( new Date( value.startDate ).getMonth()  !==  new Date().getMonth() ) ? months[( new Date().getMonth() )] : months[(new Date( value.startDate ).getMonth())] }&nbsp;
                                            { ( new Date(value.startDate + 'T00:00:00Z' ).getUTCDate() ) }
                                            { ( new Date(value.endDate + 'T00:00:00Z' ).getUTCDate() !==  new Date(value.startDate + 'T00:00:00Z' ).getUTCDate() )?
                                                " - " + ( new Date(value.endDate + 'T00:00:00Z' ).getUTCDate() )
                                                : ""
                                            }
                                            <br />
                                            {( value.bodyLines !== undefined ? (<span>{value.bodyLines[1]} </span>) : "")}
                                            {( value.body !== undefined) ? (<span>{value.body}</span>) : ""}
                                        </p>

                                    </div>
                                </div>
                            </div>
                        </div>
                        : ""
                ))
            )
        }

        function Events(){
            // Get the current date
            let currentDate = new Date();

            const months = [
                "January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];

            return (
                <section className="section-events">
                    <SpotlightHourCard currentDate={currentDate} months={months} />
                    <RaidCards currentDate={currentDate} months={months} />
                    <EventCards currentDate={currentDate} months={months} />

                </section>
            )
        }

        // TODO: Upcoming Event Bonuses
        // TODO: Current Events
        // TODO: Gearing up for PokéStop Showcases
        function EventCalendar(){
            return(
                <div className="container" >
                    <div className="month heading">December</div>
                    <div className="sections">
                        <div className="section">
                            <div className="section-title heading">Events</div>
                            <div className="section-events">
                                <EventLoop />
                            </div>
                        </div>
                        <div className="section">
                            <div className="section-title heading">Raids</div>

                                <RaidLoop />

                            <div className="section-footer">Shadow Zapdos will appear in Shadow Raids during weekends in
                                December!
                            </div>
                        </div>
                    </div>
                </div>
        )
        }

        function HomePage(){
            return(
                <div>
                    <header> <Header /> </header>
                    <div className="accordion" id="accordionExample">
                        <div className="accordion-item">
                            <h2 className="accordion-header">
                                <button className="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    Current Raids and Events
                                </button>
                            </h2>
                            <div id="collapseOne" className="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                                <div className="accordion-body">
                                    <Events />
                                </div>
                            </div>
                        </div>
                        <div className="accordion-item">
                            <h2 className="accordion-header">
                                <button className="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    Pokemon Tag Manager
                                </button>
                            </h2>
                            <div id="collapseTwo" className="accordion-collapse collapse" data-bs-parent="#accordionExample">
                                <div className="accordion-body">
                                    <SearchList />
                                </div>
                            </div>
                        </div>
                    </div>
                    <Footer />
                </div>
            )
        }

        ReactDOM.render( <HomePage />, app);
    </script>

</div>


<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
</body>
</html>